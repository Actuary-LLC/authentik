name: 'Autehntik'
on:
  workflow_dispatch:
  push:
    branches:
      - main

jobs:
  test-runner:
    runs-on: [traefik]
 #   env:
#      JUPYTER_NOTEBOOK_PASSWORD: ${{ secrets.JUPYTER_NOTEBOOK_PASSWORD }}
    steps:
   #   - name: Refresh images
  #      run: |
 #         docker image pull actuary/hub:main
  #        docker image pull actuary/notebook:main
      - name: Checkout
        uses: actions/checkout@v4.0.0
      #- name: 'Create env file'
     #   run: |
     #     echo "${{ secrets.OAUTH }}" > oauth.env
      - name: Remove and redeploy services
        run: |
          SERVICES=("external_authentik") 
          for SERVICE_NAME in "${SERVICES[@]}"; do
            if docker service ls | grep -q $SERVICE_NAME; then
              docker service rm $SERVICE_NAME;
              echo "Service $SERVICE_NAME removed."
            else echo "Service $SERVICE_NAME is not running."
            fi
          done
      - run: docker stack deploy -c authentik.yaml external
